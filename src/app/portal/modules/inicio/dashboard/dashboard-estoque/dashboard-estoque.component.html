<div class="dashboard-estoque" [class.theme-dark]="isDarkTheme">
  <!-- Cabeçalho do Dashboard -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="pi pi-chart-bar"></i>
        Dashboard de Estoque
      </h1>
      <p-button 
        icon="pi pi-refresh" 
        label="Atualizar" 
        severity="secondary"
        (onClick)="atualizarDashboard()">
      </p-button>
    </div>
  </div>

  <!-- Métricas Principais -->
  <div class="metricas-grid">
    <div class="metrica-card">
      <div class="metrica-icon">
        <i class="pi pi-box" style="color: #2196F3;"></i>
      </div>
      <div class="metrica-content">
        <h3 class="metrica-valor">{{ totalProdutos }}</h3>
        <p class="metrica-label">Total de Produtos</p>
      </div>
    </div>

    <div class="metrica-card">
      <div class="metrica-icon">
        <i class="pi pi-exclamation-triangle" style="color: #FF9800;"></i>
      </div>
      <div class="metrica-content">
        <h3 class="metrica-valor">{{ produtosBaixoEstoque }}</h3>
        <p class="metrica-label">Baixo Estoque</p>
      </div>
    </div>

    <div class="metrica-card">
      <div class="metrica-icon">
        <i class="pi pi-times-circle" style="color: #F44336;"></i>
      </div>
      <div class="metrica-content">
        <h3 class="metrica-valor">{{ produtosCriticos }}</h3>
        <p class="metrica-label">Estoque Crítico</p>
      </div>
    </div>

    <div class="metrica-card">
      <div class="metrica-icon">
        <i class="pi pi-dollar" style="color: #4CAF50;"></i>
      </div>
      <div class="metrica-content">
        <h3 class="metrica-valor">{{ formatarValor(valorTotalEstoque) }}</h3>
        <p class="metrica-label">Valor Total</p>
      </div>
    </div>

    <div class="metrica-card">
      <div class="metrica-icon">
        <i class="pi pi-arrows-alt" style="color: #9C27B0;"></i>
      </div>
      <div class="metrica-content">
        <h3 class="metrica-valor">{{ movimentacoesHoje }}</h3>
        <p class="metrica-label">Movimentações Hoje</p>
      </div>
    </div>

    <div class="metrica-card">
      <div class="metrica-icon">
        <i class="pi pi-shopping-cart" style="color: #607D8B;"></i>
      </div>
      <div class="metrica-content">
        <h3 class="metrica-valor">{{ pedidosPendentes }}</h3>
        <p class="metrica-label">Pedidos Pendentes</p>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="graficos-grid">
    <!-- Gráfico de Status do Estoque -->
    <div class="grafico-card">
      <div class="grafico-header">
        <h3>Status do Estoque</h3>
      </div>
      <div class="grafico-content">
        <p-chart 
          type="doughnut" 
          [data]="dadosGraficoEstoque"
          [options]="{
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }">
        </p-chart>
      </div>
    </div>

    <!-- Gráfico de Movimentação -->
    <div class="grafico-card">
      <div class="grafico-header">
        <h3>Movimentação (Últimos 7 dias)</h3>
      </div>
      <div class="grafico-content">
        <p-chart 
          type="line" 
          [data]="dadosGraficoMovimentacao"
          [options]="{
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }">
        </p-chart>
      </div>
    </div>

    <!-- Gráfico de Categorias -->
    <div class="grafico-card">
      <div class="grafico-header">
        <h3>Produtos por Categoria</h3>
      </div>
      <div class="grafico-content">
        <p-chart 
          type="pie" 
          [data]="dadosGraficoCategorias"
          [options]="{
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }">
        </p-chart>
      </div>
    </div>
  </div>

  <!-- Listas Recentes -->
  <div class="listas-grid">
    <!-- Produtos com Estoque Baixo -->
    <div class="lista-card">
      <div class="lista-header">
        <h3>
          <i class="pi pi-exclamation-triangle"></i>
          Produtos com Estoque Baixo
        </h3>
        <p-button 
          icon="pi pi-external-link" 
          label="Ver Todos" 
          severity="secondary"
          size="small">
        </p-button>
      </div>
      <div class="lista-content">
        <p-table 
          [value]="produtos" 
          [paginator]="false"
          [rows]="5"
          styleClass="p-datatable-sm">
          <ng-template pTemplate="header">
            <tr>
              <th>Produto</th>
              <th>Estoque Atual</th>
              <th>Mínimo</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-produto>
            <tr>
              <td>{{ produto.nome }}</td>
              <td>{{ formatarQuantidade(produto.estoqueAtual, produto.unidadeMedida) }}</td>
              <td>{{ formatarQuantidade(produto.estoqueMinimo, produto.unidadeMedida) }}</td>
              <td>
                <p-tag 
                  [value]="produto.statusEstoque" 
                  [severity]="getSeverity(produto.statusEstoque)">
                </p-tag>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Últimas Movimentações -->
    <div class="lista-card">
      <div class="lista-header">
        <h3>
          <i class="pi pi-arrows-alt"></i>
          Últimas Movimentações
        </h3>
        <p-button 
          icon="pi pi-external-link" 
          label="Ver Todas" 
          severity="secondary"
          size="small">
        </p-button>
      </div>
      <div class="lista-content">
        <p-table 
          [value]="movimentacoes" 
          [paginator]="false"
          [rows]="5"
          styleClass="p-datatable-sm">
          <ng-template pTemplate="header">
            <tr>
              <th>Produto</th>
              <th>Tipo</th>
              <th>Quantidade</th>
              <th>Data</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-movimentacao>
            <tr>
              <td>{{ movimentacao.produto?.nome }}</td>
              <td>
                <p-tag 
                  [value]="movimentacao.tipoMovimentacao" 
                  [severity]="movimentacao.tipoMovimentacao === 'Entrada' ? 'success' : 'danger'">
                </p-tag>
              </td>
              <td>{{ formatarQuantidade(movimentacao.quantidade, movimentacao.produto?.unidadeMedida) }}</td>
              <td>{{ movimentacao.dataMovimentacao | date:'dd/MM/yyyy HH:mm' }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Pedidos de Compra Pendentes -->
    <div class="lista-card">
      <div class="lista-header">
        <h3>
          <i class="pi pi-shopping-cart"></i>
          Pedidos de Compra Pendentes
        </h3>
        <p-button 
          icon="pi pi-external-link" 
          label="Ver Todos" 
          severity="secondary"
          size="small">
        </p-button>
      </div>
      <div class="lista-content">
        <p-table 
          [value]="pedidosCompra" 
          [paginator]="false"
          [rows]="5"
          styleClass="p-datatable-sm">
          <ng-template pTemplate="header">
            <tr>
              <th>Número</th>
              <th>Fornecedor</th>
              <th>Valor</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-pedido>
            <tr>
              <td>{{ pedido.numero }}</td>
              <td>{{ pedido.fornecedor?.nome }}</td>
              <td>{{ formatarValor(pedido.valorTotal) }}</td>
              <td>
                <p-tag 
                  [value]="pedido.status" 
                  [severity]="pedido.status === 'Pendente' ? 'warning' : 'info'">
                </p-tag>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div> 