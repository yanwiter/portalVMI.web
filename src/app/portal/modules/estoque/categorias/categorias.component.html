<div class="categorias">
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="pi pi-tags"></i>
        Gestão de Categorias
      </h1>
      <div class="header-actions">
        <p-button 
          icon="pi pi-plus" 
          label="Nova Categoria" 
          severity="primary"
          (onClick)="showDialog()">
        </p-button>
        <p-button 
          icon="pi pi-download" 
          label="Exportar" 
          severity="secondary"
          (onClick)="exportarParaExcel()">
        </p-button>
      </div>
    </div>
  </div>

  <div class="filtros-section">
    <div class="filtros-header">
      <h3>{{ getFiltrosHeader() }}</h3>
      <div class="filtros-actions">
        <p-button 
          icon="pi pi-search" 
          label="Filtrar" 
          severity="primary"
          size="small"
          (onClick)="filtrar()">
        </p-button>
        <p-button 
          icon="pi pi-times" 
          label="Limpar" 
          severity="secondary"
          size="small"
          (onClick)="limparFiltros()">
        </p-button>
      </div>
    </div>

    <div class="filtros-content">
      <div class="filtros-grid">
        <div class="filtro-item">
          <label for="nome">Nome</label>
          <input 
            id="nome"
            type="text" 
            pInputText 
            [(ngModel)]="filtros.nome"
            placeholder="Digite o nome">
        </div>

        <div class="filtro-item">
          <label for="status">Status</label>
          <p-dropdown 
            id="status"
            [options]="statusOptions" 
            [(ngModel)]="filtros.status"
            placeholder="Selecione o status"
            optionLabel="label"
            optionValue="value">
          </p-dropdown>
        </div>
      </div>
    </div>
  </div>

  <div class="table-section">
    <p-table 
      [value]="categorias" 
      [lazy]="true"
      [lazyLoadOnInit]="false"
      [paginator]="true"
      [rows]="currentRowsPerPage"
      [rowsPerPageOptions]="rowsPerPage"
      [totalRecords]="totalRecords"
      [loading]="tblLazyLoading"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} categorias"
      [tableStyle]="{'min-width': '50rem'}"
      (onLazyLoad)="loadTableData($event)"
      (onPage)="handlePageChange($event)"
      styleClass="p-datatable-gridlines">

      <ng-template pTemplate="header">
        <tr>
          <th>Nome</th>
          <th>Descrição</th>
          <th>Status</th>
          <th>Data Criação</th>
          <th>Ações</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-categoria>
        <tr>
          <td>{{ categoria.nome }}</td>
          <td>{{ categoria.descricao }}</td>
          <td>
            <p-tag 
              [value]="categoria.status ? 'Ativo' : 'Inativo'" 
              [severity]="categoria.status ? 'success' : 'danger'">
            </p-tag>
          </td>
          <td>{{ categoria.dataInclusao }}</td>
          <td>
            <div class="acoes-buttons">
              <p-button 
                icon="pi pi-pencil" 
                severity="info"
                size="small"
                pTooltip="Editar"
                (onClick)="iniciarEdicao(categoria)">
              </p-button>
              <p-button 
                icon="pi pi-trash" 
                severity="danger"
                size="small"
                pTooltip="Excluir"
                (onClick)="confirmarExclusao(categoria)">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Modal de Categoria -->
  <p-dialog 
    [(visible)]="displayModal" 
    [header]="modalTitle"
    [modal]="true" 
    [style]="{width: '40rem'}"
    [draggable]="false" 
    [resizable]="false"
    (onHide)="fecharModal()">

    <div class="modal-content">
      <form class="categoria-form">
        <div class="form-group">
          <label for="modal-nome">Nome *</label>
          <input 
            id="modal-nome"
            type="text" 
            pInputText 
            [(ngModel)]="categoriaEditando.nome"
            name="nome"
            placeholder="Digite o nome da categoria">
        </div>

        <div class="form-group">
          <label for="modal-descricao">Descrição</label>
          <textarea 
            id="modal-descricao"
            pInputTextarea 
            [(ngModel)]="categoriaEditando.descricao"
            name="descricao"
            [rows]="3"
            placeholder="Digite a descrição da categoria">
          </textarea>
        </div>

        <div class="form-group">
          <label for="modal-status">Status</label>
          <p-dropdown 
            id="modal-status"
            [options]="statusOptions" 
            [(ngModel)]="categoriaEditando.status"
            name="status"
            placeholder="Selecione o status"
            optionLabel="label"
            optionValue="value">
          </p-dropdown>
        </div>
      </form>
    </div>

    <ng-template pTemplate="footer">
      <div class="modal-footer">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          severity="secondary"
          (onClick)="fecharModal()">
        </p-button>
        <p-button 
          label="Salvar" 
          icon="pi pi-check" 
          severity="primary"
          (onClick)="salvarCategoria()">
        </p-button>
      </div>
    </ng-template>
  </p-dialog>

  <!-- Modal de Confirmação de Exclusão -->
  <p-dialog 
    [(visible)]="displayConfirmation" 
    [header]="modalTitleDelete"
    [modal]="true" 
    [style]="{width: '30rem'}"
    [draggable]="false" 
    [resizable]="false">

    <div class="confirmation-content">
      <i class="pi pi-exclamation-triangle" style="font-size: 3rem; color: #f44336;"></i>
      <p>Tem certeza que deseja excluir a categoria <strong>{{ categoriaParaExcluir?.nome }}</strong>?</p>
      <p class="warning-text">Esta ação não pode ser desfeita.</p>
    </div>

    <ng-template pTemplate="footer">
      <div class="confirmation-footer">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          severity="secondary"
          (onClick)="cancelarExclusao()">
        </p-button>
        <p-button 
          label="Confirmar" 
          icon="pi pi-check" 
          severity="danger"
          (onClick)="confirmarExclusaoDialog()">
        </p-button>
      </div>
    </ng-template>
  </p-dialog>
</div> 